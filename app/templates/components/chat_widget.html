<div class="flex flex-col h-full">
    <!-- Chat Header -->
    <div class="bg-blue-600 text-white p-4 rounded-t-lg">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i class="fas fa-robot"></i>
                <span class="font-semibold">MediBot</span>
            </div>
            <button onclick="toggleChat()" class="text-white hover:text-gray-200">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <p class="text-xs opacity-90 mt-1">Assistant m√©dical d'urgence</p>
    </div>

    <!-- Chat Messages -->
    <div id="chatMessages" class="flex-1 p-4 overflow-y-auto bg-gray-50 space-y-3">
        <div class="flex items-start space-x-2">
            <div class="bg-blue-600 text-white p-2 rounded-full text-xs">
                <i class="fas fa-robot"></i>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs">
                <p class="text-sm">Bonjour ! Je suis MediBot. D√©crivez-moi vos sympt√¥mes ou posez-moi une question m√©dicale.</p>
            </div>
        </div>
    </div>

    <!-- Chat Input -->
    <div class="p-4 border-t bg-white rounded-b-lg">
        <div class="flex space-x-2">
            <input 
                type="text" 
                id="chatInput" 
                placeholder="Tapez votre message..."
                class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                onkeypress="handleChatKeyPress(event)"
            >
            <button 
                onclick="sendChatMessage()" 
                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
            >
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        <div class="mt-2 text-xs text-gray-500">
            ‚ö†Ô∏è En cas d'urgence vitale, appelez le 15
        </div>
    </div>
</div>

<script>
function handleChatKeyPress(event) {
    if (event.key === 'Enter') {
        sendChatMessage();
    }
}

async function sendChatMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    // Add user message to chat
    addMessageToChat(message, 'user');
    input.value = '';
    
    // Check for emergency keywords
    const emergencyKeywords = ['douleur thoracique', 'chest pain', 'crise cardiaque', 'difficult√© respirer', 'perte de conscience'];
    const isEmergency = emergencyKeywords.some(keyword => 
        message.toLowerCase().includes(keyword.toLowerCase())
    );
    
    if (isEmergency) {
        addMessageToChat('üö® Sympt√¥mes d\'urgence d√©tect√©s ! Redirection vers le formulaire d\'alerte...', 'bot');
        setTimeout(() => {
            window.location.href = '/alert';
        }, 2000);
        return;
    }
    
    // Send to MediBot API
    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ message: message })
        });
        
        const data = await response.json();
        addMessageToChat(data.response, 'bot');
    } catch (error) {
        addMessageToChat('D√©sol√©, je rencontre un probl√®me technique. Veuillez r√©essayer.', 'bot');
    }
}

function addMessageToChat(message, sender) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = 'flex items-start space-x-2';
    
    if (sender === 'user') {
        messageDiv.innerHTML = `
            <div class="flex-1"></div>
            <div class="bg-blue-600 text-white p-3 rounded-lg shadow-sm max-w-xs">
                <p class="text-sm">${message}</p>
            </div>
            <div class="bg-gray-600 text-white p-2 rounded-full text-xs">
                <i class="fas fa-user"></i>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="bg-blue-600 text-white p-2 rounded-full text-xs">
                <i class="fas fa-robot"></i>
            </div>
            <div class="bg-white p-3 rounded-lg shadow-sm max-w-xs">
                <p class="text-sm">${message}</p>
            </div>
        `;
    }
    
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}
</script>